<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrativo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="dashboard-body">
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>ðŸ“Š Dashboard Administrativo</h1>
            <div class="header-actions">
                {% if admin_email %}
                <div class="admin-ident" title="Conta autenticada">
                    <span class="admin-dot"></span>
                    <span class="admin-email">{{ admin_email }}</span>
                </div>
                {% endif %}

                <button type="button" class="theme-toggle" id="theme-toggle" aria-label="Alternar tema">
                    ðŸŒ™
                </button>
                <a href="{{ url_for('admin_tv') }}" class="logout-btn" style="text-decoration:none;">Modo TV</a>
                <a href="{{ url_for('admin_logout') }}" class="logout-btn">Sair</a>
            </div>
        </header>
        
        <div class="dashboard-content">
            <!-- Sistema / Status -->
            <section class="system-section">
                <h2>Sistema</h2>
                <div class="system-grid">
                    <div class="system-card">
                        <div class="k">Servidor</div>
                        <div class="v" id="sys-time">â€”</div>
                        <div class="s" id="sys-python">â€”</div>
                    </div>
                    <div class="system-card">
                        <div class="k">SQLite</div>
                        <div class="v" id="sys-total">â€”</div>
                        <div class="s" id="sys-db">â€”</div>
                    </div>
                    <div class="system-card">
                        <div class="k">Firebase</div>
                        <div class="v" id="sys-firebase">â€”</div>
                        <div class="s" id="sys-project">â€”</div>
                    </div>
                    <div class="system-card">
                        <div class="k">Ãšltimo ID</div>
                        <div class="v" id="sys-last-id">â€”</div>
                        <div class="s">Ãºltimo registo</div>
                    </div>
                </div>
                <div class="system-actions">
                    <button type="button" class="secondary-btn" id="btn-refresh-system">Atualizar</button>
                    <label class="toggle">
                        <input type="checkbox" id="auto-refresh">
                        <span>Auto atualizar (30s)</span>
                    </label>
                </div>
            </section>

            <!-- EstatÃ­sticas Gerais -->
            <section class="stats-section">
                <h2>EstatÃ­sticas Gerais</h2>
                <div class="stats-grid">
                    <div class="stat-card green">
                        <div class="stat-icon">ðŸ˜Š</div>
                        <div class="stat-info">
                            <h3>Muito Satisfeito</h3>
                            <p class="stat-number" id="total-muito-satisfeito">0</p>
                            <p class="stat-percent" id="percent-muito-satisfeito">0%</p>
                        </div>
                    </div>
                    
                    <div class="stat-card blue">
                        <div class="stat-icon">ðŸ™‚</div>
                        <div class="stat-info">
                            <h3>Satisfeito</h3>
                            <p class="stat-number" id="total-satisfeito">0</p>
                            <p class="stat-percent" id="percent-satisfeito">0%</p>
                        </div>
                    </div>
                    
                    <div class="stat-card red">
                        <div class="stat-icon">ðŸ˜ž</div>
                        <div class="stat-info">
                            <h3>Insatisfeito</h3>
                            <p class="stat-number" id="total-insatisfeito">0</p>
                            <p class="stat-percent" id="percent-insatisfeito">0%</p>
                        </div>
                    </div>
                    
                    <div class="stat-card purple">
                        <div class="stat-icon">ðŸ“ˆ</div>
                        <div class="stat-info">
                            <h3>Total Geral</h3>
                            <p class="stat-number" id="total-geral">0</p>
                            <p class="stat-percent">feedbacks</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- GrÃ¡ficos -->
            <section class="charts-section">
                <h2>VisualizaÃ§Ã£o de Dados</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>GrÃ¡fico de Barras</h3>
                        <canvas id="barChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>GrÃ¡fico Circular</h3>
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </section>
            
            <!-- ComparaÃ§Ã£o entre PerÃ­odos -->
            <section class="comparison-section">
                <h2>ComparaÃ§Ã£o entre PerÃ­odos</h2>
                <div class="comparison-controls">
                    <div class="period-group">
                        <h4>PerÃ­odo 1</h4>
                        <div class="date-range-compact">
                            <div class="date-input-group">
                                <label for="comp-data1-inicio">De:</label>
                                <input type="date" id="comp-data1-inicio">
                            </div>
                            <div class="date-input-group">
                                <label for="comp-data1-fim">AtÃ©:</label>
                                <input type="date" id="comp-data1-fim">
                            </div>
                        </div>
                    </div>
                    <div class="period-group">
                        <h4>PerÃ­odo 2</h4>
                        <div class="date-range-compact">
                            <div class="date-input-group">
                                <label for="comp-data2-inicio">De:</label>
                                <input type="date" id="comp-data2-inicio">
                            </div>
                            <div class="date-input-group">
                                <label for="comp-data2-fim">AtÃ©:</label>
                                <input type="date" id="comp-data2-fim">
                            </div>
                        </div>
                    </div>
                </div>
                <button class="comparison-btn" id="btn-comparar">ðŸ“Š Comparar PerÃ­odos</button>
                <div class="comparison-results" id="comparison-results" style="display:none;">
                    <div class="comparison-grid">
                        <div class="comparison-item">
                            <h4>Muito Satisfeito</h4>
                            <div class="comparison-values">
                                <div class="comp-value">
                                    <span class="label">PerÃ­odo 1:</span>
                                    <span id="comp-ms-p1">0</span>
                                </div>
                                <div class="comp-value">
                                    <span class="label">PerÃ­odo 2:</span>
                                    <span id="comp-ms-p2">0</span>
                                </div>
                                <div class="comp-value variation" id="comp-ms-var"></div>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <h4>Satisfeito</h4>
                            <div class="comparison-values">
                                <div class="comp-value">
                                    <span class="label">PerÃ­odo 1:</span>
                                    <span id="comp-s-p1">0</span>
                                </div>
                                <div class="comp-value">
                                    <span class="label">PerÃ­odo 2:</span>
                                    <span id="comp-s-p2">0</span>
                                </div>
                                <div class="comp-value variation" id="comp-s-var"></div>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <h4>Insatisfeito</h4>
                            <div class="comparison-values">
                                <div class="comp-value">
                                    <span class="label">PerÃ­odo 1:</span>
                                    <span id="comp-i-p1">0</span>
                                </div>
                                <div class="comp-value">
                                    <span class="label">PerÃ­odo 2:</span>
                                    <span id="comp-i-p2">0</span>
                                </div>
                                <div class="comp-value variation" id="comp-i-var"></div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>GrÃ¡fico Comparativo</h3>
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </section>
            
            <!-- AnÃ¡lise Temporal -->
            <section class="temporal-section">
                <h2>AnÃ¡lise Temporal</h2>
                <div class="temporal-controls">
                    <button class="temporal-btn active" id="btn-hoje">Hoje</button>
                    <div class="date-filter">
                        <label for="date-select">Filtrar por dia:</label>
                        <select id="date-select">
                            <option value="">Carregando...</option>
                        </select>
                    </div>
                </div>
                <div class="temporal-stats" id="temporal-stats">
                    <!-- Preenchido dinamicamente -->
                </div>
            </section>
            
            <!-- ExportaÃ§Ã£o -->
            <section class="export-section">
                <h2>ExportaÃ§Ã£o de Dados</h2>
                <div class="export-controls">
                    <div class="date-range">
                        <div class="date-input-group">
                            <label for="export-date-inicio">Data InÃ­cio:</label>
                            <input type="date" id="export-date-inicio">
                        </div>
                        <div class="date-input-group">
                            <label for="export-date-fim">Data Fim:</label>
                            <input type="date" id="export-date-fim">
                        </div>
                    </div>
                    <div class="export-buttons">
                        <button class="export-btn csv" id="export-csv">ðŸ“Š Exportar Excel (XLSX)</button>
                        <button class="export-btn csv" id="export-csv-plain">ðŸ§¾ Exportar CSV</button>
                        <button class="export-btn txt" id="export-txt">ðŸ“„ Exportar TXT</button>
                    </div>
                </div>
            </section>
            
            <!-- HistÃ³rico -->
            <section class="history-section">
                <h2>HistÃ³rico de Feedbacks</h2>
                <div class="history-controls">
                    <div class="history-filters">
                        <div class="date-input-group">
                            <label for="history-search-id">ID:</label>
                            <input type="number" id="history-search-id" placeholder="Ex: 12" min="1">
                        </div>
                        <div class="date-input-group">
                            <label for="history-filter-grau">SatisfaÃ§Ã£o:</label>
                            <select id="history-filter-grau">
                                <option value="">Todas</option>
                                <option value="muito_satisfeito">Muito Satisfeito</option>
                                <option value="satisfeito">Satisfeito</option>
                                <option value="insatisfeito">Insatisfeito</option>
                            </select>
                        </div>
                        <div class="date-input-group">
                            <label for="history-date-inicio">De:</label>
                            <input type="date" id="history-date-inicio">
                        </div>
                        <div class="date-input-group">
                            <label for="history-date-fim">AtÃ©:</label>
                            <input type="date" id="history-date-fim">
                        </div>
                    </div>
                    <div class="history-actions">
                        <button class="comparison-btn" id="history-apply">Aplicar filtros</button>
                        <button class="secondary-btn" id="history-clear">Limpar</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>SatisfaÃ§Ã£o</th>
                                <th>Data</th>
                                <th>Hora</th>
                                <th>Dia da Semana</th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px;">
                                    Carregando...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="pagination">
                    <!-- Preenchido dinamicamente -->
                </div>
            </section>
        </div>
    </div>
    
    <script>
        (function() {
            const saved = localStorage.getItem('theme') || 'light';
            document.documentElement.dataset.theme = saved;
            const btn = document.getElementById('theme-toggle');
            if (btn) {
                const setIcon = () => btn.textContent = (document.documentElement.dataset.theme === 'dark') ? 'â˜€ï¸' : 'ðŸŒ™';
                setIcon();
                btn.addEventListener('click', () => {
                    const next = (document.documentElement.dataset.theme === 'dark') ? 'light' : 'dark';
                    document.documentElement.dataset.theme = next;
                    localStorage.setItem('theme', next);
                    setIcon();
                });
            }
        })();
    </script>
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
